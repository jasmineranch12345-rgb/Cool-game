<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>Arena Shooter V11.2 (Core)</title>
<style>
  html,body{height:100%;margin:0;background:#0c0c0f;touch-action:none}
  canvas{display:block}
  #ui{position:fixed;inset:0;pointer-events:none;font-family:Segoe UI,Roboto,Arial;color:#fff}
  #health-bar{position:absolute;left:16px;top:14px;width:240px;height:20px;border:2px solid #fff;background:#222}
  #health-fill{height:100%;width:100%;background:linear-gradient(90deg,#5ee07a,#37b24d)}
  #hud{position:absolute;left:16px;top:44px;font-size:18px}
  #menu,#gameover{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.85);color:#fff;z-index:40}
  .menu-panel{text-align:center}
  .big-btn{margin:12px;padding:12px 20px;background:#222;color:#fff;border-radius:10px;border:1px solid #444;font-size:18px;pointer-events:auto}
  .joystick{position:absolute;bottom:60px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06);touch-action:none;pointer-events:auto}
  #moveStick{left:40px}
  #shootStick{right:40px}
</style>
</head>
<body>
<canvas id="game"></canvas>

<div id="ui">
  <div id="health-bar"><div id="health-fill"></div></div>
  <div id="hud">Score: <span id="score">0</span></div>
</div>

<div id="menu">
  <div class="menu-panel">
    <h1>Arena Shooter</h1>
    <button class="big-btn" id="startBtn">Start Game</button>
  </div>
</div>

<div id="gameover" style="display:none;">
  <div class="menu-panel">
    <h2>Game Over</h2>
    <p id="finalScore">Score: 0</p>
    <button class="big-btn" onclick="location.reload()">Restart</button>
  </div>
</div>

<div class="joystick" id="moveStick"></div>
<div class="joystick" id="shootStick"></div>

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
resize();window.addEventListener("resize",resize);
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}

let running=false,score=0;
let player={x:canvas.width/2,y:canvas.height/2,r:18,hp:100,speed:3,fireCooldown:0};
let bullets=[],enemies=[],obstacles=[];

document.getElementById("startBtn").onclick=()=>{
  document.getElementById("menu").style.display="none";
  running=true;
  buildLevel();
  spawnEnemies();
  requestAnimationFrame(loop);
};

function buildLevel(){
  obstacles=[];
  for(let i=0;i<8;i++){
    obstacles.push({x:Math.random()*canvas.width*0.8+50,y:Math.random()*canvas.height*0.8+50,w:80,h:80});
  }
}
function spawnEnemies(){
  enemies=[];
  for(let i=0;i<6;i++){
    enemies.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:14,hp:30});
  }
}

/* ----------- Joystick logic ----------- */
let moveVec={x:0,y:0},aimVec={x:0,y:0};
function bindStick(el,vec){
  let dragging=false,cx,cy;
  const center=()=>{const r=el.getBoundingClientRect();cx=r.left+r.width/2;cy=r.top+r.height/2;};
  center();window.addEventListener("resize",center);
  el.addEventListener("touchstart",e=>{dragging=true;e.preventDefault();},{passive:false});
  el.addEventListener("touchmove",e=>{
    if(!dragging)return;
    const t=e.touches[0];let dx=t.clientX-cx,dy=t.clientY-cy;
    let d=Math.hypot(dx,dy),max=45;if(d>max){dx=dx/d*max;dy=dy/d*max;}
    vec.x=dx/max;vec.y=dy/max;e.preventDefault();
  },{passive:false});
  el.addEventListener("touchend",()=>{dragging=false;vec.x=0;vec.y=0;});
}
bindStick(document.getElementById("moveStick"),moveVec);
bindStick(document.getElementById("shootStick"),aimVec);

/* ----------- Loop ----------- */
function loop(ts){
  if(!running)return;
  update();draw();
  requestAnimationFrame(loop);
}

function update(){
  // move player
  player.x+=moveVec.x*player.speed;
  player.y+=moveVec.y*player.speed;
  // fire
  player.fireCooldown-=16;
  if((aimVec.x||aimVec.y)&&player.fireCooldown<=0){
    let a=Math.atan2(aimVec.y,aimVec.x);
    bullets.push({x:player.x,y:player.y,vx:Math.cos(a)*6,vy:Math.sin(a)*6,r:4});
    player.fireCooldown=300;
  }
  // update bullets
  bullets=bullets.filter(b=>{
    b.x+=b.vx;b.y+=b.vy;
    // obstacle collision
    for(const o of obstacles){if(b.x>o.x&&b.x<o.x+o.w&&b.y>o.y&&b.y<o.y+o.h)return false;}
    // enemy hit
    for(const e of enemies){if(Math.hypot(b.x-e.x,b.y-e.y)<e.r+b.r){e.hp-=10;score+=5;return false;}}
    return b.x>0&&b.x<canvas.width&&b.y>0&&b.y<canvas.height;
  });
  enemies=enemies.filter(e=>e.hp>0);
  // enemies chase
  for(const e of enemies){
    let dx=player.x-e.x,dy=player.y-e.y,d=Math.hypot(dx,dy);
    e.x+=dx/d*1.2;e.y+=dy/d*1.2;
    if(d<player.r+e.r){player.hp-=0.2;}
  }
  if(player.hp<=0){endGame();}
}

function draw(){
  ctx.fillStyle="#0c0c0f";ctx.fillRect(0,0,canvas.width,canvas.height);
  // obstacles
  ctx.fillStyle="#555";for(const o of obstacles){ctx.fillRect(o.x,o.y,o.w,o.h);}
  // bullets
  ctx.fillStyle="yellow";for(const b of bullets){ctx.beginPath();ctx.arc(b.x,b.y,b.r,0,Math.PI*2);ctx.fill();}
  // enemies
  ctx.fillStyle="red";for(const e of enemies){ctx.beginPath();ctx.arc(e.x,e.y,e.r,0,Math.PI*2);ctx.fill();}
  // player
  ctx.fillStyle="blue";ctx.beginPath();ctx.arc(player.x,player.y,player.r,0,Math.PI*2);ctx.fill();
  // UI
  document.getElementById("health-fill").style.width=Math.max(0,player.hp)+"%";
  document.getElementById("score").textContent=score;
}

function endGame(){
  running=false;
  document.getElementById("gameover").style.display="flex";
  document.getElementById("finalScore").textContent="Score: "+score;
}
</script>
</body>
</html>
